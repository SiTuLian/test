<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=yes">
	<title>特效三-超简易画板</title>
	<style type="text/css">
		html{
			font-size: 14px;
		}
		#div{
			width: 100%;
			height: 2rem;

		}
		#div .select-color{
			display: inline-block;
			float: left;
			width: 45%;
		}
		#div .select-size{
			display: inline-block;
			float: right;
			width: 45%;
		}
		#div select{
			width: 72%;
			/*让select的文本居中*/
			text-align-last: center;
		}
		button{
			width: 96%;
			margin: 0 auto;
			display: block;
			margin-left: 2.5%;
			margin-top: 2%;
		}
		a{
			text-decoration: none;
		}
	</style>
</head>
<body>
	<canvas id="canvas" height="300" style="border: 1px solid #333">您的浏览器不支持canvas！请换一个！</canvas>

	<div id="div">
		<div class="select-color">
			<span>颜色:</span>
			<select id="select-color">
				<option value="黑色" selected>黑色</option>
				<option value="红色">红色</option>
				<option value="橙色">橙色</option>
				<option value="黄色">黄色</option>
				<option value="绿色">绿色</option>
				<option value="蓝色">蓝色</option>
				<option value="靛色">靛色</option>
				<option value="紫色">紫色</option>
			</select>
		</div>
		<div class="select-size">
			<span>大小:</span>
			<select id="select-size">
				<option value="1" selected>1</option>
				<option value="2">2</option>
				<option value="3">3</option>
				<option value="4">4</option>
				<option value="5">5</option>
				<option value="6">6</option>
				<option value="7">7</option>
				<option value="8">8</option>
			</select>
		</div>
	</div>

	<button id="btn">清空画布</button>
	<button><a href="#" download="image1" id="a">下载图片</a></button>

	<script type="text/javascript">

		var canvas = document.getElementById('canvas');
		var w = window.innerWidth-15;
		canvas.width = w;

		var draw = canvas.getContext('2d');
		var color = "#000";
		var size = 1;

		var img = "";

		var a = document.getElementById('a');
		var btn = document.getElementById('btn');
	
		var selectColor = document.getElementById('select-color');
		var selectSize = document.getElementById('select-size');

		var color_object = {
			"黑色":"#000",
			"红色":"red",
			"橙色":"orange",
			"黄色":"yellow",
			"绿色":"green",
			"蓝色":"blue",
			"靛色":"blueviolet",
			"紫色":"violet"
		}

		var size_object = [1,2,3,4,5,6,7,8];

		selectColor.onchange = function(e){
			color = color_object[this.value];
			
		}

		selectSize.onchange = function(e){
			size = size_object[this.value];
		}


		class StraightLine{
			
			constructor(x,y){
				this.x = x;
				this.y = y;
				this.lineWidth = 1;
				this.Color = "#000";

			}
			drawLine(){

				draw.beginPath();
				draw.strokeStyle = this.Color;
				draw.lineWidth = this.lineWidth;
				draw.moveTo(this.x,this.y);

				canvas.ontouchmove = function(e){
	                draw.lineTo(e.changedTouches[0].clientX,e.changedTouches[0].clientY);
	                draw.stroke();
				}
				
			}
			
			

		}

		

		canvas.ontouchstart = function(e){

			if( e.targetTouches.length == 1 ){         
			
				var straightLine = new StraightLine(e.changedTouches[0].clientX,e.changedTouches[0].clientY);

				straightLine.Color = color;
				straightLine.lineWidth = size;
				
				straightLine.drawLine();
			
			}

		}
		canvas.ontouchend = function(e){
			this.ontouchmove = null;
			
			img = this.toDataURL('image/jpg');

            
		}

		a.onclick = function(){
			var bool = confirm("请问要下载图片吗");

			if (bool) {
				var name = prompt("请命名图片");
				a.download = name;
				a.href  = img;
			}
		}

		btn.onclick = function(){
			draw.clearRect(0,0,w,300);
		}
	</script>

</body>
</html>